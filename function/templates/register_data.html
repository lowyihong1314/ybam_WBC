<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WBC 2025 - Registration List</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #d4af37;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .session-tag {
            display: inline-block;
            background: #fef3c7;
            color: #92400e;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 500;
            margin: 0.125rem;
        }
        
        .role-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .role-monastic {
            background: #ddd6fe;
            color: #5b21b6;
        }
        
        .role-lay {
            background: #dcfce7;
            color: #166534;
        }
        
        .role-researcher {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .role-student {
            background: #fed7d7;
            color: #c53030;
        }
        
        .role-other {
            background: #f3f4f6;
            color: #374151;
        }
        
        .attendance-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .attendance-onsite {
            background: #d1fae5;
            color: #065f46;
        }
        
        .attendance-online {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .attendance-hybrid {
            background: #fef3c7;
            color: #92400e;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-slate-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <svg class="w-8 h-8 text-amber-600" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C12 2 8 6 8 12C8 16 10 18 12 18C14 18 16 16 16 12C16 6 12 2 12 2Z"/>
                        <path d="M12 18C12 18 16 14 20 14C22 14 24 16 22 18C20 20 16 18 12 18Z"/>
                        <path d="M12 18C12 18 8 14 4 14C2 14 0 16 2 18C4 20 8 18 12 18Z"/>
                    </svg>
                    <div>
                        <h1 class="text-2xl font-semibold text-slate-800">WBC 2025 Registration List</h1>
                        <p class="text-slate-600">World Buddhist Conference 2025 - Registered Participants</p>
                    </div>
                </div>
                <button id="refreshBtn" class="bg-amber-600 text-white px-4 py-2 rounded-lg hover:bg-amber-700 transition-colors flex items-center space-x-2">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                    </svg>
                    <span>Refresh</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Stats Summary -->
        <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="text-center">
                    <div class="text-3xl font-bold text-amber-600" id="totalCount">-</div>
                    <div class="text-sm text-slate-600">Total Registrations</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-green-600" id="onsiteCount">-</div>
                    <div class="text-sm text-slate-600">On-site Attendees</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-blue-600" id="onlineCount">-</div>
                    <div class="text-sm text-slate-600">Online Attendees</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-purple-600" id="monasticCount">-</div>
                    <div class="text-sm text-slate-600">Monastic Participants</div>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="text-center py-12">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-slate-600">Loading registration data...</p>
        </div>

        <!-- Error State -->
        <div id="errorState" class="hidden bg-red-50 border border-red-200 rounded-xl p-8 text-center">
            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-red-600" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
            </div>
            <h3 class="text-xl font-semibold text-red-800 mb-2">Failed to Load Data</h3>
            <p class="text-red-700 mb-4">Unable to fetch registration data from the server.</p>
            <button id="retryBtn" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">
                Try Again
            </button>
        </div>

        <!-- Registration List -->
        <div id="registrationList" class="hidden space-y-4">
            <!-- Registration cards will be inserted here -->
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="hidden text-center py-12">
            <div class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-slate-400" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                </svg>
            </div>
            <h3 class="text-xl font-semibold text-slate-600 mb-2">No Registrations Yet</h3>
            <p class="text-slate-500">Registration data will appear here once participants start signing up.</p>
        </div>
    </main>

    <script>
        let registrationData = [];

        // Session name mapping
        const sessionNames = {
            'keynote': 'Keynote Presentations',
            'panel1': 'AI Ethics & Compassion',
            'panel2': 'Mindfulness & Digital Well-being',
            'panel3': 'Monastic & Lay Perspectives',
            'workshops': 'Workshops'
        };

        // Fetch registration data
        async function fetchRegistrations() {
            showLoading();

            try {
                const response = await fetch('/wbc/wbc_register');

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                registrationData = data.data || [];

                updateStats(data);
                renderRegistrations();

            } catch (error) {
                console.error('Error fetching registrations:', error);
                showError();
            }
        }

        // Show loading state
        function showLoading() {
            document.getElementById('loadingState').classList.remove('hidden');
            document.getElementById('errorState').classList.add('hidden');
            document.getElementById('registrationList').classList.add('hidden');
            document.getElementById('emptyState').classList.add('hidden');
        }

        // Show error state
        function showError() {
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('errorState').classList.remove('hidden');
            document.getElementById('registrationList').classList.add('hidden');
            document.getElementById('emptyState').classList.add('hidden');
        }

        // Update statistics
        function updateStats(data) {
            const total = data.count || 0;
            const registrations = data.data || [];

            // Count by attendance mode
            const onsiteCount = registrations.filter(r => r.attendance === 'onsite').length;
            const onlineCount = registrations.filter(r => r.attendance === 'online').length;
            const monasticCount = registrations.filter(r => r.role === 'monastic').length;

            document.getElementById('totalCount').textContent = total;
            document.getElementById('onsiteCount').textContent = onsiteCount;
            document.getElementById('onlineCount').textContent = onlineCount;
            document.getElementById('monasticCount').textContent = monasticCount;
        }

        // Render registration list
        function renderRegistrations() {
            const listContainer = document.getElementById('registrationList');

            if (registrationData.length === 0) {
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('emptyState').classList.remove('hidden');
                return;
            }

            listContainer.innerHTML = '';

            registrationData.forEach((registration, index) => {
                const card = createRegistrationCard(registration, index);
                listContainer.appendChild(card);
            });

            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('registrationList').classList.remove('hidden');
        }

        // Create registration card
        function createRegistrationCard(registration, index) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-xl shadow-sm border border-slate-200 p-6 fade-in';
            card.style.animationDelay = `${index * 0.1}s`;

            const sessions = Array.isArray(registration.sessions) ? registration.sessions : [];
            const sessionTags = sessions.map(session =>
                `<span class="session-tag">${sessionNames[session] || session}</span>`
            ).join('');

            card.innerHTML = `
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
                    <div class="flex-1">
                        <div class="flex items-start justify-between mb-4">
                            <div>
                                <h3 class="text-xl font-semibold text-slate-800 mb-1">${escapeHtml(registration.fullName)}</h3>
                                <p class="text-slate-600">${escapeHtml(registration.email)}</p>
                            </div>
                            <div class="flex flex-col items-end space-y-2">
                                <span class="role-badge role-${registration.role}">${registration.role}</span>
                                <span class="attendance-badge attendance-${registration.attendance}">${registration.attendance}</span>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <span class="text-sm font-medium text-slate-700">Country/Region:</span>
                                <span class="text-slate-600 ml-2">${escapeHtml(registration.country)}</span>
                            </div>
                            <div>
                                <span class="text-sm font-medium text-slate-700">Affiliation:</span>
                                <span class="text-slate-600 ml-2">${escapeHtml(registration.affiliation)}</span>
                            </div>
                        </div>
                        
                        ${sessions.length > 0 ? `
                            <div class="mb-4">
                                <span class="text-sm font-medium text-slate-700 block mb-2">Sessions of Interest:</span>
                                <div class="flex flex-wrap">
                                    ${sessionTags}
                                </div>
                            </div>
                        ` : ''}
                        
                        ${registration.accessibility && registration.accessibility.trim() ? `
                            <div>
                                <span class="text-sm font-medium text-slate-700">Accessibility Needs:</span>
                                <p class="text-slate-600 mt-1 text-sm">${escapeHtml(registration.accessibility)}</p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            return card;
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Event listeners
        document.getElementById('refreshBtn').addEventListener('click', fetchRegistrations);
        document.getElementById('retryBtn').addEventListener('click', fetchRegistrations);

        // Initial load
        fetchRegistrations();
    </script>
    <script>
        (function() {
            function c() {
                var b = a.contentDocument || a.contentWindow.document;
                if (b) {
                    var d = b.createElement('script');
                    d.innerHTML = "window.__CF$cv$params={r:'98ae7bf721affd9e',t:'MTc1OTg1MTQ5My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
                    b.getElementsByTagName('head')[0].appendChild(d)
                }
            }
            if (document.body) {
                var a = document.createElement('iframe');
                a.height = 1;
                a.width = 1;
                a.style.position = 'absolute';
                a.style.top = 0;
                a.style.left = 0;
                a.style.border = 'none';
                a.style.visibility = 'hidden';
                document.body.appendChild(a);
                if ('loading' !== document.readyState) c();
                else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c);
                else {
                    var e = document.onreadystatechange || function() {};
                    document.onreadystatechange = function(b) {
                        e(b);
                        'loading' !== document.readyState && (document.onreadystatechange = e, c())
                    }
                }
            }
        })();
    </script>
</body>

</html>